{% extends "base.html" %}

{% block title %}2AV-Bagages - Service de transport de bagages{% endblock %}

{% block extra_css %}
<style>
    /* Reset du background pour la page d'accueil */
    body {
        background: linear-gradient(135deg, #87CEEB 0%, #E0F6FF 50%, #B0E0E6 100%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    .container {
        max-width: none;
        padding: 0;
    }

    /* Header avec navigation */
    .site-header {
        background: white;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        transition: all 0.3s ease;
    }

    .site-header.scrolled {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
    }

    .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
    }

    .site-logo {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        text-decoration: none;
    }

    .logo-icon {
        background: linear-gradient(45deg, #FF8C42, #FFA500);
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .nav-menu {
        display: flex;
        list-style: none;
        gap: 30px;
        align-items: center;
    }

    .nav-link {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
    }

    .nav-link:hover {
        color: #FF8C42;
    }

    .nav-link::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(45deg, #FF8C42, #FFA500);
        transition: width 0.3s ease;
    }

    .nav-link:hover::after {
        width: 100%;
    }

    .contact-info {
        display: flex;
        align-items: center;
        gap: 20px;
        font-size: 0.9rem;
    }

    .contact-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #333;
    }

    .contact-item i {
        color: #FF8C42;
    }

    /* Hero Section */
    .hero {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 120px 20px 80px;
        position: relative;
        overflow: hidden;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.1)" points="0,1000 1000,0 1000,1000"/></svg>');
        background-size: cover;
    }

    .hero-content {
        max-width: 800px;
        z-index: 2;
        position: relative;
    }

    .hero-badge {
        background: rgba(255,255,255,0.9);
        color: #FF8C42;
        padding: 10px 25px;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 30px;
        display: inline-block;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.2;
    }

    .hero-subtitle {
        font-size: 1.3rem;
        color: #555;
        margin-bottom: 40px;
        line-height: 1.5;
    }

    .hero-features {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 50px;
        flex-wrap: wrap;
    }

    .hero-feature {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255,255,255,0.8);
        padding: 15px 20px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .hero-feature i {
        color: #FF8C42;
        font-size: 1.2rem;
    }

    .hero-feature span {
        font-weight: 600;
        color: #333;
    }

    /* Booking Form */
    .booking-form {
        background: white;
        padding: 40px;
        border-radius: 25px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        max-width: 900px;
        margin: 0 auto;
        border-top: 5px solid #FF8C42;
    }

    .form-title {
        text-align: center;
        font-size: 2rem;
        color: #333;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .form-subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 40px;
        font-size: 1.1rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 25px;
    }

    .form-group {
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #E0F6FF;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #FAFFFE;
    }

    .form-control:focus {
        outline: none;
        border-color: #FF8C42;
        box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.1);
        background: white;
    }

    .price-display {
        background: linear-gradient(45deg, #51CF66, #69DB7C);
        color: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin: 25px 0;
        font-size: 1.2rem;
        font-weight: 600;
        display: none;
    }

    .price-amount {
        font-size: 2rem;
        margin-top: 10px;
    }

    .btn-book {
        width: 100%;
        background: linear-gradient(45deg, #FF8C42, #FFA500);
        color: white;
        border: none;
        padding: 18px 30px;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-book:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(255, 140, 66, 0.4);
    }

    /* Notification */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #51CF66, #69DB7C);
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 10000;
        display: none;
        align-items: center;
        gap: 10px;
        font-weight: 500;
    }

    .notification.show {
        display: flex;
        animation: slideInRight 0.4s ease-out;
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(100%); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .nav-menu {
            display: none;
        }

        .contact-info {
            display: none;
        }

        .hero-title {
            font-size: 2.5rem;
        }

        .hero-features {
            flex-direction: column;
            align-items: center;
        }

        .booking-form {
            padding: 25px;
            margin: 20px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<header class="site-header" id="header">
    <div class="nav-container">
        <a href="#" class="site-logo">
            <div class="logo-icon">
                <i class="fas fa-suitcase-rolling"></i>
            </div>
            <span>2AV-Bagages</span>
        </a>

        <nav class="nav-menu">
            <a href="#accueil" class="nav-link">Accueil</a>
            <a href="#services" class="nav-link">Services</a>
            <a href="#couverture" class="nav-link">Couverture</a>
            <a href="#contact" class="nav-link">Contact</a>
            <a href="{{ url_for('admin_login') }}" class="nav-link">Connexion</a>
        </nav>

        <div class="contact-info">
            <div class="contact-item">
                <i class="fas fa-phone"></i>
                <span>06-63-49-70-64</span>
            </div>
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <span>2av.bagage@gmail.com</span>
            </div>
        </div>
    </div>
</header>

<!-- Hero Section -->
<section class="hero" id="accueil">
    <div class="hero-content">
        <div class="hero-badge">
            <i class="fas fa-star"></i> Service Premium de Transport de Bagages
        </div>
        
        <h1 class="hero-title">Voyagez Léger<br>avec 2AV-Bagages</h1>
        
        <p class="hero-subtitle">
            Confiez-nous vos bagages et concentrez-vous sur l'essentiel de votre voyage.
            Service fiable, rapide et sécurisé dans toute la France.
        </p>

        <div class="hero-features">
            <div class="hero-feature">
                <i class="fas fa-clock"></i>
                <span>Réservation flexible</span>
            </div>
            <div class="hero-feature">
                <i class="fas fa-euro-sign"></i>
                <span>Tarifs réduits</span>
            </div>
            <div class="hero-feature">
                <i class="fas fa-map-marked-alt"></i>
                <span>Couverture nationale</span>
            </div>
            <div class="hero-feature">
                <i class="fas fa-shield-alt"></i>
                <span>Transport sécurisé</span>
            </div>
        </div>

        <!-- Formulaire de réservation -->
        <div class="booking-form">
            <h2 class="form-title">Réservez votre transport</h2>
            <p class="form-subtitle">Remplissez le formulaire ci-dessous pour obtenir un devis instantané</p>
            
            <form id="bookingForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="clientType">
                            <i class="fas fa-users"></i> Type de client
                        </label>
                        <select id="clientType" class="form-control" required>
                            <option value="">Sélectionnez votre profil</option>
                            <option value="individuel">Individuel</option>
                            <option value="famille">Famille</option>
                            <option value="pmr">PMR (Personne à Mobilité Réduite)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="destination">
                            <i class="fas fa-map-marker-alt"></i> Destination
                        </label>
                        <select id="destination" class="form-control" required>
                            <option value="">Choisissez votre destination</option>
                            <option value="aeroport">Aéroport</option>
                            <option value="gare">Gare</option>
                            <option value="port">Port</option>
                            <option value="domicile">Domicile</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pickupAddress">
                            <i class="fas fa-home"></i> Adresse de collecte
                        </label>
                        <input type="text" id="pickupAddress" class="form-control" 
                               placeholder="Votre adresse complète" required>
                    </div>

                    <div class="form-group">
                        <label for="bagCount">
                            <i class="fas fa-suitcase"></i> Nombre de bagages
                        </label>
                        <select id="bagCount" class="form-control" required>
                            <option value="">Nombre de bagages</option>
                            <option value="1">1 bagage</option>
                            <option value="2">2 bagages</option>
                            <option value="3">3 bagages</option>
                            <option value="4+">4 bagages ou plus</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pickupDate">
                            <i class="fas fa-calendar"></i> Date de collecte
                        </label>
                        <input type="date" id="pickupDate" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="pickupTime">
                            <i class="fas fa-clock"></i> Heure de collecte
                        </label>
                        <input type="time" id="pickupTime" class="form-control" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="clientName">
                            <i class="fas fa-user"></i> Nom complet
                        </label>
                        <input type="text" id="clientName" class="form-control" 
                               placeholder="Votre nom et prénom" required>
                    </div>

                    <div class="form-group">
                        <label for="clientEmail">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input type="email" id="clientEmail" class="form-control" 
                               placeholder="votre@email.com" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="clientPhone">
                            <i class="fas fa-phone"></i> Téléphone
                        </label>
                        <input type="tel" id="clientPhone" class="form-control" 
                               placeholder="06 12 34 56 78" required>
                    </div>

                    <div class="form-group">
                        <label for="specialInstructions">
                            <i class="fas fa-sticky-note"></i> Instructions spéciales
                        </label>
                        <input type="text" id="specialInstructions" class="form-control" 
                               placeholder="Informations complémentaires (optionnel)">
                    </div>
                </div>

                <div class="price-display" id="priceDisplay">
                    <div><i class="fas fa-calculator"></i> Prix estimé :</div>
                    <div class="price-amount" id="priceAmount">0€</div>
                </div>

                <button type="submit" class="btn-book">
                    <i class="fas fa-paper-plane"></i> Réserver maintenant
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Notification -->
<div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText"></span>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Variables globales
    let currentPrice = 0;

    // Configuration des tarifs
    const pricing = {
        base: {
            pmr: 15.75,
            famille: 13.75,
            individuel: 17.00
        },
        destinations: {
            aeroport: 15.00,
            gare: 8.00,
            port: 12.00,
            domicile: 5.00
        }
    };

    // Header scroll effect
    window.addEventListener('scroll', function() {
        const header = document.getElementById('header');
        if (window.scrollY > 100) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
    });

    // Calcul du prix en temps réel
    function calculatePrice() {
        const clientType = document.getElementById('clientType').value;
        const destination = document.getElementById('destination').value;
        const bagCount = document.getElementById('bagCount').value;

        if (!clientType || !destination || !bagCount) {
            document.getElementById('priceDisplay').style.display = 'none';
            return;
        }

        const pricePerBag = pricing.base[clientType] || 17.00;
        const destinationSupplement = pricing.destinations[destination] || 10.00;
        
        let numBags = 1;
        switch(bagCount) {
            case '1': numBags = 1; break;
            case '2': numBags = 2; break;
            case '3': numBags = 3; break;
            case '4+': numBags = 4; break;
        }

        currentPrice = (pricePerBag * numBags) + destinationSupplement;

        document.getElementById('priceAmount').textContent = currentPrice.toFixed(2) + '€';
        document.getElementById('priceDisplay').style.display = 'block';
    }

    // Événements pour le calcul automatique du prix
    ['clientType', 'destination', 'bagCount'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculatePrice);
    });

    // Définir la date minimale à aujourd'hui
    document.getElementById('pickupDate').min = new Date().toISOString().split('T')[0];

    // Gestion du formulaire de réservation
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = {
            client_type: document.getElementById('clientType').value,
            destination: document.getElementById('destination').value,
            pickup_address: document.getElementById('pickupAddress').value,
            pickup_datetime: document.getElementById('pickupDate').value + ' ' + document.getElementById('pickupTime').value,
            bag_count: document.getElementById('bagCount').value,
            client_name: document.getElementById('clientName').value,
            client_email: document.getElementById('clientEmail').value,
            client_phone: document.getElementById('clientPhone').value,
            special_instructions: document.getElementById('specialInstructions').value
        };

        if (!formData.client_type || !formData.destination || !formData.pickup_address || 
            !formData.client_name || !formData.client_email || !formData.client_phone) {
            showNotification('Veuillez remplir tous les champs obligatoires.', 'error');
            return;
        }

        submitBooking(formData);
    });

    // Fonction de soumission de réservation
    async function submitBooking(data) {
        try {
            const submitBtn = document.querySelector('.btn-book');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi en cours...';
            submitBtn.disabled = true;

            const response = await fetch('/book', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                showNotification(
                    `Réservation confirmée ! Numéro: #${result.booking_id || 'XXX'}. Vous recevrez un email de confirmation.`, 
                    'success'
                );
                
                document.getElementById('bookingForm').reset();
                document.getElementById('priceDisplay').style.display = 'none';
            } else {
                throw new Error('Erreur lors de la réservation');
            }

        } catch (error) {
            console.error('Erreur:', error);
            showNotification(
                'Une erreur est survenue. Veuillez réessayer ou nous contacter directement.', 
                'error'
            );
        } finally {
            const submitBtn = document.querySelector('.btn-book');
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Réserver maintenant';
            submitBtn.disabled = false;
        }
    }

    // Système de notifications
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        const colors = {
            success: 'linear-gradient(45deg, #51CF66, #69DB7C)',
            error: 'linear-gradient(45deg, #FF6B6B, #FF8787)',
            info: 'linear-gradient(45deg, #87CEEB, #B0E0E6)'
        };

        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };

        notification.style.background = colors[type] || colors.success;
        notification.querySelector('i').className = `fas ${icons[type] || icons.success}`;
        notificationText.textContent = message;

        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    // Format du numéro de téléphone
    document.getElementById('clientPhone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/, '$1 $2 $3 $4 $5');
        }
        e.target.value = value;
    });

    // Smooth scrolling pour les liens de navigation
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
</script>
{% endblock %}
